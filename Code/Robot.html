<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="utf-8">
  <title>CPC354 Demo</title>


  <!-- Link CSS, JS, and WebGL -->
  <!-- webgl-utils.js : standard utilities from Google to set up a WebGL context -->
  <!-- initShaders.js : contains helper functions to compile and link WebGL shaders to the application -->
  <!-- MV.js      : provides matrix and vector manipulation functions APIs for WebGL -->
  <!-- DemoJS.js    : your JS file -->
  <!-- DemoCSS.css  : your CSS file -->
  <script type="text/javascript" src="../Common/webgl-utils.js"></script>
  <script type="text/javascript" src="../Common/initShaders.js"></script>
  <script type="text/javascript" src="../Common/MV.js"></script>
  <script type="text/javascript" src="Robot.js"></script>
  <script type="text/javascript" src="../Common/Geometry.js"></script>
  <link rel="stylesheet" type="text/css" href="Robot.css">


  <!-- Define the vertex shader -->
  <script id="vertex-shader" type="x-shader/x-vertex">
    // Uniforms (same for all vertices)
    uniform mat4 projectionMatrix;
    uniform mat4 modelViewMatrix;
    uniform mat3 normalMatrix;

    // Attributes (per vertex)
    attribute vec4 vPosition;
    attribute vec4 vColor;
    attribute vec3 vNormal;

    // Varyings (pass to fragment shader)
    varying vec4 fColor;
    varying vec3 fNormal;
    varying vec3 fPosition;

    void main()
    {
      // Transform position
      vec4 worldPos = modelViewMatrix * vPosition;
      gl_Position = projectionMatrix * worldPos;
      
      // Transform normal (don't apply translation)
      fNormal = normalMatrix * vNormal;
      
      // Pass position in view space
      fPosition = worldPos.xyz;
      
      // Pass color
      fColor = vColor;
    }
  </script>


  <!-- Define the fragment shader -->
  <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;
    
    // Inputs from vertex shader
    varying vec4 fColor;
    varying vec3 fNormal;        
    varying vec3 fPosition;      
    
    // Uniforms
    uniform bool isBall;
    uniform vec4 collisionColor;
    uniform vec3 lightPosition;     
    uniform vec3 lightColor;      
    uniform float materialShininess; 

    void main() {
      vec3 color;
      
      if (isBall) {
        color = collisionColor.rgb;
      } else {
        color = fColor.rgb;
      }
      
      // Normalize the normal
      vec3 N = normalize(fNormal);
      
      // Light direction
      vec3 L = normalize(lightPosition - fPosition);
      
      // View direction
      vec3 V = normalize(-fPosition);
      
      // Reflection direction
      vec3 R = reflect(-L, N);
      
      // --- PHONG LIGHTING MODEL ---
      
      // Ambient (base lighting)
      vec3 ambient = 0.8 * color;
      
      // Diffuse (matte surface)
      float diffuseStrength = max(dot(N, L), 0.0);
      vec3 diffuse = diffuseStrength * color * lightColor;
      
      // Specular (shiny highlights)
      float specularStrength = pow(max(dot(V, R), 0.0), materialShininess);
      vec3 specular = specularStrength * lightColor * 0.6;

      float rimStrength = 1.0 - max(dot(V, N), 0.0);
      rimStrength = pow(rimStrength, 3.0);
      vec3 rimColor = vec3(0.3, 0.4, 0.6) * rimStrength * 0.3;
      
      // Combine all lighting
      vec3 finalColor = ambient + diffuse + specular + rimColor;
      
      gl_FragColor = vec4(finalColor, collisionColor.a);
    }
  </script>
</head>


<body>
  <div class="main-container">
    <!-- Keyboard Controls Legend -->
    <div class="keyboard-legend">
      <div class="legend-title">KEYBOARD CONTROLS</div>
      
      <div class="legend-section">
        <div class="legend-section-title">Movement</div>
        <div class="legend-item">
          <div class="key-group">
            <kbd class="key">A</kbd>
            <kbd class="key">D</kbd>
          </div>
          <span class="legend-desc">Robot X Position</span>
        </div>
      </div>

      <div class="legend-section">
        <div class="legend-section-title">Rotation</div>
        <div class="legend-item">
          <div class="key-group">
            <kbd class="key">Q</kbd>
            <kbd class="key">E</kbd>
          </div>
          <span class="legend-desc">Base Angle</span>
        </div>
        <div class="legend-item">
          <div class="key-group">
            <kbd class="key">Z</kbd>
            <kbd class="key">X</kbd>
          </div>
          <span class="legend-desc">Wrist Rotation</span>
        </div>
      </div>

      <div class="legend-section">
        <div class="legend-section-title">Arms</div>
        <div class="legend-item">
          <div class="key-group">
            <kbd class="key">W</kbd>
            <kbd class="key">S</kbd>
          </div>
          <span class="legend-desc">Upper Arm</span>
        </div>
        <div class="legend-item">
          <div class="key-group">
            <kbd class="key">R</kbd>
            <kbd class="key">F</kbd>
          </div>
          <span class="legend-desc">Lower Arm</span>
        </div>
      </div>

      <div class="legend-section">
        <div class="legend-section-title">Grippers</div>
        <div class="legend-item">
          <div class="key-group">
            <kbd class="key">C</kbd>
            <kbd class="key">V</kbd>
          </div>
          <span class="legend-desc">Inner Grip</span>
        </div>
        <div class="legend-item">
          <div class="key-group">
            <kbd class="key">G</kbd>
            <kbd class="key">H</kbd>
          </div>
          <span class="legend-desc">Outer Grip</span>
        </div>
      </div>

      <div class="legend-section">
        <div class="legend-section-title">Action</div>
        <div class="legend-item">
          <kbd class="key key-wide">SPACE</kbd>
          <span class="legend-desc">Grab/Release Ball</span>
        </div>
      </div>
    </div>

    <!-- Canvas for the graphic rendering -->
    <div class="canvas-container">
      <div class="score-panel">
        <div class="stat-box">
          <div class="stat-label">Win Streak</div>
          <div class="stat-value" id="win-count">0</div>
        </div>
        <div class="stat-box highlight">
          <div class="stat-label">Best Record</div>
          <div class="stat-value" id="game-personal-best-text">0</div>
        </div>
        <div class="game-status" id="game-status-text">Let us start the game ðŸ¤ž</div>
      </div>
     
      <div class="canvas">
        <canvas id="gl-canvas" width="1280" height="720">
          Error: your browser doesn't support the HTML5 canvas element
        </canvas>
      </div>
    </div>


    <!-- Panel for parameter customization -->
    <div class="panel vertical-align">
      <div class="panel-title">CONTROLS</div>
     
      <!-- Slider for base angle -->
      <div class="param-panel horizontal-align control-group">
        <div class="slider">
          <div class="control-label">
            <span class="label-text">Base Angle</span>
            <span class="textbox">
              <p id="base-text">0</p>
            </span>
          </div>
          <div class="slider-container">
            <span class="slider-min">0</span>
            <input class="slide" id="base-slider" type="range" min="0" max="360" value="0">
            <span class="slider-max">360</span>
          </div>
        </div>
      </div>


      <!-- Slider for x translation for the robot -->
      <div class="param-panel horizontal-align control-group">
        <div class="slider">
          <div class="control-label">
            <span class="label-text">Robot X</span>
            <span class="textbox">
              <p id="robot-x-text">0</p>
            </span>
          </div>
          <div class="slider-container">
            <span class="slider-min">-10</span>
            <input class="slide" id="robot-x" type="range" min="-10" max="10" value="0" step="0.1">
            <span class="slider-max">10</span>
          </div>
        </div>
      </div>


      <!-- Slider for upper arm angle -->
      <div class="param-panel horizontal-align control-group">
        <div class="slider">
          <div class="control-label">
            <span class="label-text">Upper Arm Angle</span>
            <span class="textbox">
              <p id="uarm-text">0</p>
            </span>
          </div>
          <div class="slider-container">
            <span class="slider-min">-90</span>
            <input class="slide" id="uarm-slider" type="range" min="-90" max="90" value="0">
            <span class="slider-max">90</span>
          </div>
        </div>
      </div>


      <!-- Slider for lower arm angle -->
      <div class="param-panel horizontal-align control-group">
        <div class="slider">
          <div class="control-label">
            <span class="label-text">Lower Arm Angle</span>
            <span class="textbox">
              <p id="larm-text">0</p>
            </span>
          </div>
          <div class="slider-container">
            <span class="slider-min">-90</span>
            <input class="slide" id="larm-slider" type="range" min="-90" max="90" value="0">
            <span class="slider-max">90</span>
          </div>
        </div>
      </div>


      <div class="param-panel horizontal-align control-group">
        <div class="slider">
          <div class="control-label">
            <span class="label-text">Inner Grip</span>
            <span class="textbox">
              <p id="innerGrip-text">30</p>
            </span>
          </div>
          <div class="slider-container">
            <span class="slider-min">20</span>
            <input class="slide" id="innerGrip-slider" type="range" min="20" max="90" value="30">
            <span class="slider-max">90</span>
          </div>
        </div>
      </div>


      <div class="param-panel horizontal-align control-group">
        <div class="slider">
          <div class="control-label">
            <span class="label-text">Outer Grip</span>
            <span class="textbox">
              <p id="outerGrip-text">-38</p>
            </span>
          </div>
          <div class="slider-container">
            <span class="slider-min">-90</span>
            <input class="slide" id="outerGrip-slider" type="range" min="-90" max="0" value="-38">
            <span class="slider-max">0</span>
          </div>
        </div>
      </div>


      <div class="param-panel horizontal-align control-group">
        <div class="slider">
          <div class="control-label">
            <span class="label-text">Gripper Wrist</span>
            <span class="textbox">
              <p id="wrist-z-text">0</p>
            </span>
          </div>
          <div class="slider-container">
            <span class="slider-min">-180</span>
            <input class="slide" id="wrist-z-slider" type="range" min="-180" max="180" value="0">
            <span class="slider-max">180</span>
          </div>
        </div>
      </div>

			<div class="button-group"> 
        <div id="game-controls">
          <button id="grab-button"><span>Grab Ball</span></button>
          <button id="restart-button"><span>Restart</span></button>
          <button id="demo-button"><span>Gameplay demonstration</span></button>
        </div>

        <div id="demo-controls" style="display: none;">
          <button id="pause-demo-btn"><span>Pause Demo</span></button>
          <button id="restart-demo-btn"><span>Restart Demo</span></button>
          <button id="quit-demo-btn"><span>Quit Demo</span></button>
        </div>
      </div>

      <!-- Until here -->
    </div>
  </div>

  <div id="custom-modal-overlay" class="modal-overlay hidden">
  <div class="modal-box">
    <div class="modal-header">
      <h3 id="modal-title" class="modal-title">CONFIRM ACTION</h3>
    </div>
    <div class="modal-body">
      <p id="modal-message">Are you sure?</p>
    </div>
    <div class="modal-actions">
      <button id="modal-cancel-btn" class="modal-btn cancel">CANCEL</button>
      <button id="modal-confirm-btn" class="modal-btn confirm">CONFIRM</button>
    </div>
  </div>
</div>

<div id="game-over-modal" class="modal-overlay hidden">
  <div class="modal-box game-over">
    <div class="modal-header">
      <h3 class="modal-title error">MISSION FAILED</h3>
    </div>
    <div class="modal-body">
      <p id="game-over-message">System Failure.</p>
    </div>
    <div class="modal-actions center">
      <button id="game-over-btn" class="modal-btn danger">RESTART SYSTEM</button>
    </div>
  </div>
</div>


</body>


</html>

